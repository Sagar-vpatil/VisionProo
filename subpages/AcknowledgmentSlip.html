<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Provisional Slip</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>

@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap');

body {
    font-family: 'Noto Sans Devanagari', 'Mangal', 'Helvetica Neue', Arial, sans-serif;
    margin: 20px;
    background-color: #f9f9f9;
}
        /* Styling for Balance Due */
        #balanceDue {
            font-weight: bold;
            padding: 8px;
            border: none;
            outline: none;
            background-color: transparent;
        }
        .paid {
            color: green; /* Green when payment is complete */
        }
        .due {
            color: red; /* Red when balance is due */
        }

        @page {
            size: A4;
            margin: 0;
        }

        .container {
            max-width: 210mm; /* A4 width */
            min-height: auto; /* A4 height */
            margin: 0 auto;
            padding: 30px;
            position: relative;
            background: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 26px;
            font-weight: bold;
            color: #007bff;
        }

        .header p {
            font-size: 16px;
            color: #555;
            font-weight: 600;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: #0056b3;
            margin-top: 20px;
            padding-bottom: 5px;
            border-bottom: 2px solid #0056b3;
        }

        .details-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .details-table th,
        .details-table td {
            padding: 12px;
            border: 1px solid #ddd;
            font-size: 16px;
            text-align: center;
            vertical-align: middle;
        }

        .details-table th {
            background-color: #f1f1f1;
            color: #333;
            font-weight: 600;
        }

        .details-table td {
            background-color: #f9f9f9;
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }

        .btn-print {
            display: block;
            width: 100%;
            max-width: 200px;
            margin: 20px auto;
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s ease;
        }

        .btn-print:hover {
            background-color: #0056b3;
        }

        .rupee-input {
            text-align: right;
            font-size: 16px;
            padding-left: 10px;
        }

        @media print {
            .container {
                padding: 15px;
                min-height: auto;
                page-break-after: always;
                box-shadow: none;
            }

            .form-control {
                border: 1px solid #000;
                background: transparent;
                -webkit-print-color-adjust: exact;
            }

            input[type="text"] {
                border: none;
                background: transparent;
                width: 100%;
            }

            .btn-print {
                display: none;
            }

            input, select {
                display: none; /* Hide input and select elements during printing */
            }

            .print-visible {
                display: inline-block !important; /* Show static values during printing */
            }

            .print-hidden {
                display: none !important; /* Hide input and select elements during printing */
            }

            .signature {
                text-align: right;
                font-style: italic;
            }

            .signature::before {
                content: "_______________";
                display: block;
                margin-bottom: 10px;
                margin-top: 100px;
            }

            input[type="date"] {
                appearance: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                border: none;
                padding: 0;
                background: transparent;
                font-family: 'Georgia', serif;
                font-size: 12pt;
                color: #333;
                width: auto;
                line-height: 1.6;
                text-align: center;
            }

            input[type="date"]::-webkit-calendar-picker-indicator {
                display: none;
            }

            input[type="date"]:before {
                content: attr(value);
            }

            .navbar .buttons button {
                display: none;
            }
        }

        /* Input and Select Styling */
        .form-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            color: #333;
        }

        .form-control:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
        }

        body, .page {
            margin: 0;
            padding: 0;
            box-shadow: none;
        }

        /* Define A4 page size and margins explicitly */
        @page {
            size: A4;
            margin: 0mm; /* Set a 10mm margin on all sides for the printable area */
        }

        /* Navbar Styling */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f8f8;
            padding: 5px 10px;
        }

        .navbar img {
            height: 50px;
            margin-left: 20px;
        }

        .navbar .buttons {
            display: flex;
            gap: 10px;
        }

        .navbar .buttons button {
            padding: 8px 16px;
            font-size: 14px;
            background: #d32f2f;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

         /* Center the input field */
         .center-container {
            display: flex;
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            height: 100vh; /* Full viewport height */
        }

        #dateInput {
            width: 120px; /* Set width */
            text-align: center; /* Center text inside input */
            padding: 8px; /* Add padding for better appearance */
            font-size: 16px; /* Set font size */
            border: 1px solid #ddd; /* Add border */
            border-radius: 4px; /* Rounded corners */
        }



        
  /* Header Section */
  .letterhead {
        border-bottom: 2px solid #070a0d;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: relative; /* Added for positioning doctor names */
    }

    .hospital-logo {
        width: 160px;
        height: 110px;
    }

    .hospital-info {
        text-align: right;
    }

    .hospital-name {
        font-family: 'Helvetica Neue', sans-serif;
        font-weight: 700;
        color: red;
        font-size: 32px;
        letter-spacing: 1.5px;
    }

    .hospital-address {
        font-size: 18px;
        color: #666;
       
    }

    /* Doctor's Name Styling */
    .doctor-name-left,
    .doctor-name-right {
        position: absolute;
        top: 0;
        font-family: 'Helvetica Neue', sans-serif;
        font-size: 15px;
        font-weight: 500;
        color: #333;
    }

    .doctor-name-left {
        left: 0; /* Position on the left corner */
    }

    .doctor-name-right {
        right: 0; /* Position on the right corner */
    }
    </style>
</head>
<body>
    <nav class="navbar">
        <div style="display: flex; align-items: center;"></div>
        <div class="buttons" style="margin-bottom: 10px;">
            <button onclick="window.location.href='./main.html';">üè† Home</button>
            <button onclick="updatePrintValues()">üñ®Ô∏è Print</button>
        </div>
    </nav>
    <div class="container">
        <div class="provisional-slip">
            <!-- Header -->
            <div class="letterhead">
                <!-- Left Corner - Doctor's Name -->
                <div class="doctor-name-left" style="margin-top: 80px;">
                    Dr. Alvin R. Rane.<br> M.S. (Netrarog)<br>
                </div>
            
                <!-- Hospital Logo and Info -->
                <div style="margin-left: 125px; margin-bottom: 20px;" >
                    <img src="../assets/images/Ravikalp_Hospital__new_logo-removebg-preview.png" alt="Hospital Logo" class="hospital-logo">
                </div>
                <div class="hospital-info" style="margin-right: 190px; margin-bottom: 25px; " >
                    <div class="hospital-name">‡§∞‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤</div>
                    <div class="hospital-address" style="margin-right: 0px;">EYE & GENERAL HOSPITAL<br>PHACO & LASER CENTER</div>
                </div>
            
                <!-- Right Corner - Doctor's Name -->
                <div class="doctor-name-right" style="margin-top: 80px;">
                    Dr. Selina¬†A.¬†Rane <br> M.D. (Ayu)<br>
                </div>
                
            </div>
            <div class="address-section">
    
                <p class="hospital-address-details" style="margin-top: 5px;">
                    <i class="fa-solid fa-location-dot" style="font-size: 20px; width: 24px; height: 25px; margin-left: 0px; color: red;margin-top: 3px;"></i> 518/1/6,Near Panchamukhi Hanuman Mandir Colony Road, Jalgaon | Phone: +91 9423902084
                </p>
                <hr style="border: 1px solid #070a0d;">
            </div>
            <!-- Patient Details -->
            <div class="patient-details">
                <div class="section-title">Patient Information</div>
                <table class="details-table">
                    <tr>
                        <th>Date</th>
                        <td>
                            <input type="text" id="dateInput" placeholder="DD/MM/YYYY" onchange="updateDate()" class="form-control print-hidden" style="width: 120px; margin-left: 150px;">
                            <span id="currentDate" class="print-visible" style="display: none;"></span>
                        </td>
                    </tr>
                     <tr>
                        <th>  Receipt No</th>
                        <td id="ack-no"></td>
                    </tr>
                    <tr>
                        <th>Patient ID</th>
                        <td id="patient-id"></td>
                    </tr>
                    <tr>
                        <th>Patient Name</th>
                        <td id="patient-name"></td>
                    </tr>
                    <tr>
                        <th>Age</th>
                        <td id="patient-age"></td>
                    </tr>
                    <tr>
                        <th>Gender</th>
                        <td id="patient-gender"></td>
                    </tr>
                    <tr>
                        <th>Contact Number</th>
                        <td id="patient-mobile"></td>
                    </tr>
                </table>
            </div>

            <!-- Payment Details -->
            <div class="payment-details">
                <div class="section-title">Payment Information</div>
                <table class="details-table">
                    <tr>
                        <th style="text-align: center; vertical-align: middle;">Amount Paid</th>
                        <td style="text-align: center; vertical-align: middle;">
                            <input type="text" id="amountPaid" placeholder="‚Çπ 0" class="form-control rupee-input" 
                            style="width: 200px; text-align: center; display: block; margin: auto;">
                        </td>
                    </tr>
                    <tr>
                        <th>Payment Mode</th>
                        <td>
                            <select id="paymentMode" class="form-control print-hidden" 
                                style="width: 200px; text-align: center; display: block; margin: auto;">
                                <option value="Cash">Cash</option>
                                <option value="Credit Card">Credit Card</option>
                                <option value="UPI">UPI</option>
                                <option value="Insurance">Insurance</option>
                            </select>
                            <span class="print-visible" id="printPaymentMode" style="display: none; margin: 0 auto; text-align: center;">Cash</span>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="footer" style="color: black;">
                <div class="signature" style="margin-right: 30px;">
                    <p>Dr. Alvin R Rane</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Retrieve the appointment object from localStorage
        const appointment = JSON.parse(window.localStorage.getItem("appointment")) || {};
        document.getElementById("patient-id").textContent = appointment.id || "N/A";
        document.getElementById("patient-name").textContent = appointment.Name || "N/A";
        document.getElementById("patient-age").textContent = appointment.Age ? appointment.Age + " yrs" : "N/A";
        document.getElementById("patient-gender").textContent = appointment.Gender || "N/A";
        document.getElementById("patient-mobile").textContent = appointment.MobileNo || "N/A";
        
        // Generate and display the acknowledgment number
        const appointmentId = appointment.id || "0";
        const paddedId = appointmentId.replace(/\D/g, '').padStart(4, '0');

        const curDate = new Date();
        const format = (n) => n.toString().padStart(2, '0');

        const ackNo = `${paddedId}${format(curDate.getDate())}${format(curDate.getMonth() + 1)}${curDate.getFullYear().toString().slice(-2)}${format(curDate.getHours())}${format(curDate.getMinutes())}${format(curDate.getSeconds())}`;

        document.getElementById("ack-no").textContent = ackNo;



        // Set current date with the format DD/MM/YYYY
        function setCurrentDate() {
            const dateInput = document.getElementById('dateInput');
            const currentDate = new Date().toLocaleDateString('en-IN', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            dateInput.value = currentDate; // Set the input value
            document.getElementById('currentDate').textContent = currentDate; // Set display value
        }

        // Function to update the date based on the input field
        function updateDate() {
            const dateInput = document.getElementById('dateInput');
            const selectedDate = dateInput.value;

            // Validate the date format (DD/MM/YYYY)
            const datePattern = /^\d{2}\/\d{2}\/\d{4}$/;
            if (datePattern.test(selectedDate)) {
                document.getElementById('currentDate').textContent = selectedDate; // Update display value
            } else {
                window.electronAPI.showErrorBox("Error", "Invalid date format. Please use DD/MM/YYYY.");
                setCurrentDate(); // Reset to current date if invalid
            }
        }

        // Set the current date on page load
        setCurrentDate();

        // Function to update print values and trigger print
        function updatePrintValues() {
            // Update payment mode for printing
            document.getElementById('printPaymentMode').textContent = document.getElementById('paymentMode').value;

            // Print the acknowledgment slip
            const patientId = "P" + appointment.id;
            const tempDateStr = localStorage.getItem("tempDate");
            let today;
            if (tempDateStr) {
                today = new Date(...tempDateStr.split("/").reverse().map((v, i) => (i === 1 ? v - 1 : +v)));
            } else {
                today = new Date(); // Ensure `today` is always a Date object
            }
            const date = today.toLocaleDateString("en-GB").replace(/\//g, "-");
            const docName = patientId + "_AckSlip" + "_" + date;
            console.log(patientId, date, docName);

            // Check if Electron API is available
            if (window.electronAPI) {
                window.electronAPI.printPage(patientId, date, docName);
            } else {
                console.error("Electron API is not available.");
                window.print(); // Fallback to browser print
            }
        }

        // Format amount paid input
        document.getElementById('amountPaid').addEventListener('input', formatAmountPaid);

        function formatAmountPaid(event) {
            let input = event.target;
            let value = input.value.replace(/[^\d]/g, ''); // Remove non-numeric characters

            if (value === "") {
                input.value = "‚Çπ 0"; // Display ‚Çπ 0 if empty
                return;
            }

            input.value = "‚Çπ " + parseFloat(value).toLocaleString("en-IN");
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>