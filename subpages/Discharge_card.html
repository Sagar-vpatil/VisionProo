<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discharge Summary - Professional Print Layout</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        /* Base Styling */
        @page {
            size: A4;
            margin: 0;
        }

        .container {
            max-width: 210mm; /* A4 width */
            min-height: 297mm; /* A4 height */
            margin: 0 auto;
            padding: 30px;
            position: relative;
            background: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .small-input {
            width: 80px;
            padding: 5px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            margin: 0 5px;
        }

        /* Header Section */
        .letterhead {
            border-bottom: 2px solid #070a0d;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        .hospital-logo {
            width: 160px;
            height: 110px;
        }

        .hospital-info {
            text-align: right;
        }

        .hospital-name {
            font-family: 'Helvetica Neue', sans-serif;
            font-weight: 700;
            color: red;
            font-size: 32px;
            letter-spacing: 1.5px;
        }

        .hospital-address {
            font-size: 18px;
            color: #666;
        }

        .doctor-name-left,
        .doctor-name-right {
            position: absolute;
            top: 0;
            font-family: 'Helvetica Neue', sans-serif;
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }

        .doctor-name-left {
            left: 0;
        }

        .doctor-name-right {
            right: 0;
        }

        /* Clinical Sections */
        .section-title {
            font-family: 'Helvetica Neue', sans-serif;
            color: #004a99;
            border-bottom: 1px solid #080e14;
            padding-bottom: 8px;
            margin: 25px 0 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 18px;
            page-break-after: avoid;
        }

        /* Patient Table */
        .patient-table {
            width: 100%;
            border-collapse: collapse;
        }

        .patient-table th, .patient-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
            vertical-align: middle;
        }

        .patient-table th {
            color: #000;
            text-align: left;
        }

        /* Procedure Boxes */
        .procedure-table {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 8px;
        }

        .procedure-box {
            flex: 1;
            min-width: 200px;
            max-width: 220px;
            border: 1px solid black;
            padding: 8px;
            text-align: left;
            font-size: 12px;
            line-height: 1.2;
            background: #f8f9fa;
            height: 280px;
        }

        .procedure-box strong {
            font-size: 13px;
        }

        .procedure-box ol {
            padding-left: 15px;
        }

        .procedure-box li {
            font-size: 12px;
            margin-bottom: 3px;
        }

        /* Investigation Section */
        .investigation-container {
            margin-top: 20px;
            text-align: center;
        }

        .investigation-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }

        .investigation-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .investigation-item span {
            font-weight: bold;
        }

        .investigation-item input {
            width: 100px;
            padding: 5px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        /* IOL Sticker Section */
        .iol-sticker-section {
            display: block;
        }

        .iol-sticker {
            width: 380px;
            height: 80px;
            border: 2px solid black;
            padding: 15px;
            text-align: center;
            font-size: 14px;
            margin: 0 auto;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .print-checkbox {
            margin-right: 10px;
        }

        /* Table Styling */
        .table th, .table td {
            border: 1px solid black;
            padding: 5px;
            text-align: center;
            font-size: 14px;
        }

        .table-bordered th, .table-bordered td {
            border: 2px solid black !important;
            border-collapse: collapse !important;
        }

        #Medicines-Table {
            background-color: #f9f9f9;
        }

        /* Navbar Styling */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f8f8;
            padding: 5px 10px;
        }

        .navbar img {
            height: 50px;
            margin-left: 20px;
        }

        .navbar .buttons {
            display: flex;
            gap: 10px;
        }

        .navbar .buttons button {
            padding: 8px 16px;
            font-size: 14px;
            background: #d32f2f;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        /* Print-Specific Styling */
        @media print {
            body, .patient-details, .Pre-Operative-Details {
                margin: 0 !important;
                padding: 0 !important;
            }

            .container {
                padding: 15px;
                min-height: auto;
                page-break-after: always;
                box-shadow: none;
            }

            .navbar, .print-btn, .buttons, .hr {
                display: none !important;
            }

            .no-print {
                display: none !important;
            }

            input[type="text"], input[type="date"] {
                border: none !important;
                background: transparent !important;
                padding: 0;
                font-size: 12pt;
                color: #000;
                -webkit-appearance: none;
                appearance: none;
            }

            input[type="text"]::after {
                content: attr(value);
                display: block;
                text-align: start;
                position: absolute;
                left: 0;
                width: 100%;
                color: black;
                font-family: inherit;
                font-size: inherit;
            }

            input[type="date"]::-webkit-calendar-picker-indicator {
                display: none;
            }

            .print-checkbox {
                display: none !important;
            }

            .print-checkboex {
               display: inline-block;
            }
            .signature {
                text-align: right;
                font-style: italic;
                margin-top: 20px;
            }

            .signature::before {
                content: "_______________";
                display: block;
                margin-bottom: 10px;
            }

            .hospital-logo {
                width: 160px;
                height: 110px;
                margin-left: 20px;
            }

            /* Ensure sections don't split */
            .eye-examination-section, .medicines-section, #A-Scan-Table, .iol-sticker-section {
                page-break-inside: avoid;
            }

            /* Medicines Table */
            #Medicines-Table thead th {
                background-color: #e0e0e0;
                color: #000;
            }

            #Medicines-Table tbody tr {
                background-color: #f9f9f9;
            }

            /* Pre-Operative Table */
            #Pre-Operative-Table {
                width: 100% !important;
                max-width: 400px !important;
                margin: 0 auto !important;
                border: 1pt solid #000 !important;
                page-break-inside: avoid;
            }

            #Pre-Operative-Table th, #Pre-Operative-Table td {
                padding: 3pt !important;
                border: 1pt solid #000 !important;
                font-size: 12pt !important;
            }

            #Pre-Operative-Table th {
                background-color: #f0f0f0 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .complaints.show-BP {
                min-width: 120px !important;
                margin-left: 90px !important;
                padding: 2px !important;
                font-size: 10pt !important;
            }

            /* IOL Sticker Section */
            .iol-sticker-section.hidden {
                display: none !important;
            }

            .iol-sticker {
                width: 100mm; /* Approx 380px at 96 DPI */
                height: 25mm; /* Approx 110px at 96 DPI */
                border: 2px solid black;
                padding: 4mm;
                font-size: 14pt;
                background: #fff;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div style="display: flex; align-items: center;"></div>
        <div class="buttons" style="margin-bottom: 10px;">
            <button onclick="window.location.href='./main.html';">🏠 Home</button>
            <button onclick="printFunction()">🖨️ Print Discharge Card</button>
        </div>
    </nav>

    <div class="container">
        <!-- Letterhead -->
        <div class="letterhead">
            <div class="doctor-name-left" style="margin-top: 70px;">
               Dr. Emily J. Watson <br> M.D. (Cardiology)<br>
            </div>
            <div style="margin-left: 125px;margin-top: 10px; ">
                <img src="../assets/logo/logo_demo-removebg-preview.png" alt="Hospital Logo" class="hospital-logo">
            </div>
              <div class="hospital-info" style="margin-right: 58%; margin-bottom: 10px;">
                <div class="hospital-name" style="font-size:2.5REM;">VisionProo</div>
                
                
            </div>
            <div class="doctor-name-right" style="margin-top: 70px;">
                Dr. Rajesh K. Patel <br> M.D. (Ayu)<br>
            </div>
        </div>
        <div class="address-section">
            <p class="hospital-address-details" style="margin-top: 5px;">
                <i class="fa-solid fa-location-dot" style="font-size: 20px; width: 24px; height: 20px; margin-left: 25px; color: red;"></i> lot No. 78, 
Opp. Mandir Road, Colony Area,
Jalgaon – 425001
    |📞 +91 91234 56789
            </p>
            </p>
            <hr style="border: 1px solid #070a0d;">
        </div>

        <div style="text-align: center; margin: 20px 0;">
            <h2 style="font-size: 24px; color: #004a99; text-decoration: underline;">DISCHARGE SUMMARY</h2>
        </div>

        <!-- Patient Information -->
        <div class="patient-info-card">
            <table class="table table-bordered patient-table">
                <tbody>
                    <tr>
                        <th>Patient ID:</th>
                        <td id="patient-id"></td>
                        <th>Name:</th>
                        <td id="patient-name">Pratham Ganesh Mistari</td>
                    </tr>
                    <tr>
                        <th>Age:</th>
                        <td id="patient-age">40 yrs</td>
                        <th>Gender:</th>
                        <td id="patient-gender">Male</td>
                    </tr>
                    <tr>
                        <th>Date of Birth:</th>
                        <td id="patient-dob">N/A</td>
                        <th>Address:</th>
                        <td id="patient-address">N/A</td>
                    </tr>
                    <tr>
                        <th>Admission Date:</th>
                        <td><input type="date" id="admission-input" oninput="updateDateField(this, 'admission-value')"></td>
                        <th>Discharge Date:</th>
                        <td><input type="date" id="discharge-input" oninput="updateDateField(this, 'discharge-value')"></td>
                    </tr>
                    <tr>
                        <th>Surgeon Name:</th>
                        <td>Dr. Alvin R Rane</td>
                        <th>Surgery Name:</th>
                        <td class="show-SurgicalTreatment">Cataract Surgery</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Diagnosis Section -->
        <h4 class="section-title">Diagnosis</h4>
        <div class="d-flex flex-wrap gap-2 show-diagnosis"></div>

        <!-- Operative Notes Section -->
        <h4 class="section-title">OPERATIVE NOTES</h4>
        <div class="procedure-table">
            <div class="procedure-box">
                <input type="checkbox" class="print-checkboex" id="phaco-check"> <strong>Phaco</strong>
                <ol>
                    <li>P & D With Betadin Solution.</li>
                    <li>Site Port with 15 Blade.</li>
                    <li>Incision clear corneal 2.2mm / 2.8mm.</li>
                    <li>Anterior capsule stain with Blue-dye.</li>
                    <li>Capsulorhexis done with cystotome.</li>
                    <li>Hydrodelineation & Hydrodissection done.</li>
                    <li>Phaco-Treaching & Aspiration with Phaco Probe.</li>
                    <li>Foldable IOL kept in Bag.</li>
                    <li>Wound Hydrated.</li>
                    <li>Eye Patched.</li>
                </ol>
            </div>
            <div class="procedure-box">
                <input type="checkbox" class="print-checkboex" id="sics-check"> <strong>SICS</strong>
                <ol>
                    <li>P & D Dropping with Betadine.</li>
                    <li>Conjunctival Flap Done.</li>
                    <li>Tunnel with crescent Blade.</li>
                    <li>Site port with 15 No Blade.</li>
                    <li>Capsulorhexis with cystotome.</li>
                    <li>Main entry done with 3.2 Blade.</li>
                    <li>Hydrodissection done.</li>
                    <li>Nucleus delivery with vectis.</li>
                    <li>Cortex aspiration with symcoe cannula.</li>
                    <li>PCL kept in Bag.</li>
                    <li>Wound Hydrated.</li>
                    <li>Subconj inj. given.</li>
                    <li>Eye Patched.</li>
                </ol>
            </div>
            <div class="procedure-box">
                <input type="checkbox" class="print-checkboex" id="pterygium-check"> <strong>Pterygium</strong>
                <ol>
                    <li>P & D Done.</li>
                    <li>Subconj inj. given.</li>
                    <li>Main Mass separated from cornea.</li>
                    <li>Pungium Excised.</li>
                    <li>Superiority graft Separates & Put on excised area.</li>
                    <li>Clint instilled.</li>
                    <li>Eye Patched.</li>
                </ol>
            </div>
        </div>

        <!-- Investigation Section -->
        <h4 class="section-title" id="investigation-title">Investigation</h4>
        <div class="investigation-container">
            <div class="investigation-list"></div>
        </div>

        <!-- A-Scan Table -->
        <h4 class="section-title" id="A-Scan-Heading">A-Scan Report</h4>
        <table class="table" style="width: 450px; margin: 0 auto;" id="A-Scan-Table">
            <thead>
                <tr>
                    <th></th>
                    <th>Right</th>
                    <th>Left</th>
                </tr>
            </thead>
            <tbody>
                <tr style="height: 10px;">
                    <td style="font-size: 12px;">K1</td>
                    <td id="RightK1" style="font-size: 11px;"></td>
                    <td id="LeftK1" style="font-size: 11px;"></td>
                </tr>
                <tr style="height: 15px;">
                    <td style="font-size: 12px;">K2</td>
                    <td id="RightK2" style="font-size: 11px;"></td>
                    <td id="LeftK2" style="font-size: 11px;"></td>
                </tr>
                <tr style="height: 15px;">
                    <td style="font-size: 11px;">LT</td>
                    <td id="RightLT" style="font-size: 11px;"></td>
                    <td id="LeftLT" style="font-size: 11px;"></td>
                </tr>
                <tr style="height: 15px;">
                    <td style="font-size: 11px;">AXL</td>
                    <td id="RightAL" style="font-size: 11px;"></td>
                    <td id="LeftAL" style="font-size: 11px;"></td>
                </tr>
                <tr style="height: 15px;">
                    <td style="font-size: 11px;">ACD</td>
                    <td id="RightACD" style="font-size: 11px;"></td>
                    <td id="LeftACD" style="font-size: 11px;"></td>
                </tr>
                <tr style="height: 15px;">
                    <td style="font-size: 11px;">L.Power</td>
                    <td id="RightLPower" style="font-size: 11px;">1</td>
                    <td id="LeftLPower" style="font-size: 11px;">1</td>
                </tr>
                <tr style="height: 15px;">
                    <td style="font-size: 11px;">A.Constant</td>
                    <td id="RightAConstant" style="font-size: 11px;"></td>
                    <td id="LeftAConstant" style="font-size: 11px;"></td>
                </tr>
                <tr style="height: 15px;">
                    <td style="font-size: 11px;">IOL</td>
                    <td id="RightIOL" style="font-size: 11px;"></td>
                    <td id="LeftIOL" style="font-size: 11px;"></td>
                </tr>
            </tbody>
        </table>

        <!-- IOL Sticker Section -->
        <div class="iol-sticker-section" id="iol-sticker-section">
            <h4 class="section-title">
                <input type="checkbox" class="print-checkbox" id="iol-sticker-check" checked> IOL STICKER
            </h4>
            <div class="iol-sticker" id="iol-sticker-content">IOL Sticker Details</div>
        </div>

        <!-- Pre-Operative Workup Investigations -->
        <div class="patient-details Pre-Operative-Details" style="height: 60px;">
            <h4 class="section-title">Pre-Operative Workup Investigations</h4>
            <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 10px 90px;">
                <p class="complaints show-BP" style="min-width: 120px;"></p>
                <p class="complaints show-Pulse-Rate" style="min-width: 120px;"></p>
                <p class="complaints show-SAC" style="min-width: 120px;"></p>
                <p class="complaints show-NCT"></p>
                <p class="complaints show-additional"></p>
            </div>
        </div>

        <table id="Pre-Operative-Table" style="width: 470px; margin-left: 120px; border-collapse: collapse; text-align: center; border: 1px solid #000; margin-top: 0px;">
            <h4 class="section-title" id="Pre-Operative-Heading">NCT</h4>
            <thead>
                <tr style="background-color: #f0f0f0; border: 1px solid #000;">
                    <th colspan="2" style="padding: 8px; border: 1px solid #000;">Right Eye</th>
                    <th colspan="2" style="padding: 8px; border: 1px solid #000;">Left Eye</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="input-wrapper" style="padding: 5px; border: 1px solid #000;">
                        <span id="RightmmHg">Data</span>
                        <span>mmHg</span>
                    </td>
                    <td style="padding: 5px; border: 1px solid #000;">
                        <span id="RightmmHgTime">00:00</span>
                    </td>
                    <td class="input-wrapper" style="padding: 5px; border: 1px solid #000;">
                        <span id="LeftmmHg">Data</span>
                        <span>mmHg</span>
                    </td>
                    <td style="padding: 5px; border: 1px solid #000;">
                        <span id="LeftmmHgTime">00:00</span>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Post Operative Treatment -->
        <h4 class="section-title" id="Medicines-Heading">Post Operative Treatment</h4>
        <table class="table table-responsive table-bordered" id="Medicines-Table" style="width: 500px; margin: 0 auto; background-color: #f9f9f9;">
            <thead>
                <tr>
                    <th scope="col" class="text-center fw-bold" style="background-color: #e0e0e0; padding: 10px;">Medicine Name</th>
                    <th scope="col" class="text-center fw-bold" style="background-color: #e0e0e0; padding: 10px;">Dose</th>
                </tr>
            </thead>
            <tbody id="medicines-tbody">
                <tr>
                    <td class="text-start" style="padding: 10px;">Aspirin</td>
                    <td class="text-start" style="padding: 10px;">500mg</td>
                </tr>
                <tr>
                    <td class="text-start" style="padding: 10px;">Paracetamol</td>
                    <td class="text-start" style="padding: 10px;">1000mg</td>
                </tr>
            </tbody>
        </table>

        <h4 class="section-title" id="Post-Operative-Medicine-Heading">Post Operative Treatment</h4>
        <table style="width: 80%; border-collapse: collapse; font-size: 14px; margin-left: 120px; margin-top: 20px;" id="Post-Operative-Medicine-Template">
            <thead>
                <tr style="height: 25px; background-color: #fff;">
                    <th style="border: 1px solid #0f0808; padding: 5px;">Medicine</th>
                    <th style="border: 1px solid #0f0d0d; padding: 5px;">Dose</th>
                    <th style="border: 1px solid #070707; padding: 5px;">Instructions</th>
                </tr>
            </thead>
            <tbody>
                <tr style="height: 20px;" id="Medicine1">
                    <td style="border: 1px solid #0a0707; padding: 5px;">Gatiquin P Eye Drop</td>
                    <td style="border: 1px solid #131212; padding: 5px;">(01)</td>
                    <td style="border: 1px solid #0a0909; padding: 5px;">८ वेळा २-२ तासाने एक-एक थेंब.</td>
                </tr>
                <tr style="height: 20px;" id="Medicine2">
                    <td style="border: 1px solid #0e0d0d; padding: 5px;">Homide Eye Drop</td>
                    <td style="border: 1px solid #080808; padding: 5px;">(01)</td>
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">२ वेळा एक-एक थेंब</td>
                </tr>
                <tr style="height: 20px;" id="Medicine3">
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">Tobastar eye drop</td>
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">(01)</td>
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">दिवसातून ४ वेळा.</td>
                </tr>
                <tr style="height: 20px;" id="Medicine4">
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">Tab. Ciprobid 500mg</td>
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">(10)</td>
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">सकाळ... संध्याकाळी.</td>
                </tr>
                <tr style="height: 20px;" id="Medicine5">
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">Tab. Pantosec DSR</td>
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">(05)</td>
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">1 वेळा</td>
                </tr>
                <tr style="height: 20px;" id="Medicine6">
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">Tab. Eyeview</td>
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">(30)</td>
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">1 वेळा</td>
                </tr>
                <tr style="height: 20px;" id="Medicine7">
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">Nepa OD eye drop</td>
                    <td style="border: 1px solid #0c0b0b; padding: 5px;">(01)</td>
                    <td style="border: 1px solid #141414; padding: 5px;">२ वेळा एक-एक थेंब</td>
                </tr>
            </tbody>
        </table>

        <div class="footer" style="color: black;">
            <div class="signature" style="margin-right: 30px;">
                <p>Dr. Alvin R Rane</p>
            </div>
        </div>
    </div>

    <script>
        const tempDateStr = localStorage.getItem("tempDate");
        function printFunction() {
            const patientId = "P" + appointment.id;
            let today;
            if (tempDateStr) {
                today = new Date(...tempDateStr.split("/").reverse().map((v, i) => (i === 1 ? v - 1 : +v)));
            } else {
                today = new Date();
            }
            const date = today.toLocaleDateString("en-GB").replace(/\//g, "-");
            const Docname = patientId + "_DischargeCard_" + date;
            window.electronAPI.printPage(patientId, date, Docname);
        }

        const appointment = JSON.parse(window.localStorage.getItem("appointment")) || {};

        function formatDate(isoDate) {
            if (!isoDate) return "N/A";
            const [year, month, day] = isoDate.split("-");
            return `${day}-${month}-${year}`;
        }

        // Update patient information
        document.getElementById("patient-id").textContent = appointment.id || "N/A";
        document.getElementById("patient-name").textContent = appointment.Name || "N/A";
        document.getElementById("patient-age").textContent = appointment.Age ? appointment.Age + " yrs" : "N/A";
        document.getElementById("patient-gender").textContent = appointment.Gender || "N/A";
        document.getElementById("patient-dob").textContent = formatDate(appointment.BirthDate);
        document.getElementById("patient-address").textContent = appointment.Address || "N/A";

        // Surgical Treatment
        const selectedSurgicalTreatment = JSON.parse(localStorage.getItem("selectedSurgicalTreatment")) || [];
        const SurgicalTreatmentSection = document.querySelector(".show-SurgicalTreatment");
        SurgicalTreatmentSection.innerHTML = selectedSurgicalTreatment.length > 0 ? selectedSurgicalTreatment.join(' <span style="font-weight: bold; color: black;">|</span> ') : "N/A";

        // Diagnosis
        const selectedDiagnosis = JSON.parse(localStorage.getItem("selectedDiagnosis")) || [];
        const diagnosisSection = document.querySelector(".show-diagnosis");
        diagnosisSection.innerHTML = selectedDiagnosis.length > 0 ? selectedDiagnosis.join(' <span style="font-weight: bold; color: black;">|</span> ') : "N/A";

        // A-Scan Table
        const aScanTable = JSON.parse(localStorage.getItem("aScanTable")) || {};
        const aScanTableElement = document.getElementById("A-Scan-Table");
        const aScanHeading = document.getElementById("A-Scan-Heading");
        const aScanRows = aScanTableElement.querySelectorAll("tbody tr");
        const aScanRowMapping = [
            { rowIndex: 0, rightKey: "RightK1", leftKey: "LeftK1" },
            { rowIndex: 1, rightKey: "RightK2", leftKey: "LeftK2" },
            { rowIndex: 2, rightKey: "RightLT", leftKey: "LeftLT" },
            { rowIndex: 3, rightKey: "RightAL", leftKey: "LeftAL" },
            { rowIndex: 4, rightKey: "RightACD", leftKey: "LeftACD" },
            { rowIndex: 5, rightKey: "RightLPower", leftKey: "LeftLPower" },
            { rowIndex: 6, rightKey: "RightAConstant", leftKey: "LeftAConstant" },
            { rowIndex: 7, rightKey: "RightIOL", leftKey: "LeftIOL" }
        ];

        let visibleAScanRowCount = 0;
        aScanRowMapping.forEach(({ rowIndex, rightKey, leftKey }) => {
            const rightValue = aScanTable[rightKey] || "";
            const leftValue = aScanTable[leftKey] || "";
            if (rightValue === "" && leftValue === "") {
                aScanRows[rowIndex].style.display = "none";
            } else {
                aScanRows[rowIndex].style.display = "";
                aScanRows[rowIndex].querySelector(`#${rightKey}`).textContent = rightValue || "-";
                aScanRows[rowIndex].querySelector(`#${leftKey}`).textContent = leftValue || "-";
                visibleAScanRowCount++;
            }
        });
        aScanTableElement.style.display = visibleAScanRowCount > 0 ? "table" : "none";
        aScanHeading.style.display = visibleAScanRowCount > 0 ? "block" : "none";

        // Investigations
        const selectedInvestigations = JSON.parse(localStorage.getItem("selectedInvestigation")) || [];
        const investigationContainer = document.querySelector(".investigation-list");
        if (selectedInvestigations.length > 0) {
            investigationContainer.innerHTML = "";
            selectedInvestigations.forEach((investigation) => {
                const investigationItem = document.createElement("div");
                investigationItem.classList.add("investigation-item");
                investigationItem.innerHTML = `<span>${investigation}:</span><input type="text" class="small-input">|`;
                investigationContainer.appendChild(investigationItem);
            });
        } else {
            document.getElementById("investigation-title").style.display = "none";
            investigationContainer.style.display = "none";
        }

        // Medicines Table
        const medicines = JSON.parse(localStorage.getItem("medicines")) || [];
        const medicinesTable = document.getElementById("Medicines-Table");
        const medicinesTbody = medicinesTable.querySelector("tbody");
        const medicinesHeading = document.getElementById("Medicines-Heading");
        if (medicines.length === 0) {
            medicinesTable.style.display = "none";
            medicinesHeading.style.display = "none";
        } else {
            medicinesTable.style.display = "table";
            medicinesTbody.innerHTML = "";
            medicines.forEach((medicine) => {
                const row = document.createElement("tr");
                row.innerHTML = `<td>${medicine.medicineSelect || "-"}</td><td>${medicine.medicineDose || "-"}</td>`;
                medicinesTbody.appendChild(row);
            });
        }

        // Pre-Operative Details
        const preOperativeDetails = JSON.parse(localStorage.getItem("PreOperativeDetails")) || {};
        const fieldMappings = [
            { key: "BPResult", className: "show-BP", label: "BP" },
            { key: "PulseRate", className: "show-Pulse-Rate", label: "P" },
        ];
        let visibleCount = 0;
        fieldMappings.forEach(({ key, className, label }) => {
            const element = document.querySelector(`.${className}`);
            if (element) {
                const value = preOperativeDetails[key]?.trim() || "";
                if (value) {
                    element.innerHTML = `<span style="font-weight: bold; font-size: 17px;">${label} :</span> ${value}`;
                    visibleCount++;
                } else {
                    element.style.display = "none";
                }
            }
        });
        if (!preOperativeDetails.SACResultRE && !preOperativeDetails.SACResultLE) {
            document.querySelector(".show-SAC").style.display = "none";
        } else {
            let sacContent = `<span style="font-weight: bold; font-size: 17px;">SAC :</span>`;
            if (preOperativeDetails.SACResultRE) {
                sacContent += ` <span style="font-weight: bold; font-size: 15px;">RE - </span>${preOperativeDetails.SACResultRE}`;
            }
            if (preOperativeDetails.SACResultLE) {
                if (preOperativeDetails.SACResultRE) {
                    sacContent += ` <span style="font-weight: bold; font-size: 17px;">|</span>`;
                }
                sacContent += ` <span style="font-weight: bold; font-size: 15px;">LE -</span> ${preOperativeDetails.SACResultLE}`;
            }
            document.querySelector(".show-SAC").innerHTML = sacContent;
            visibleCount++;
        }
        const patientDetailsSection = document.querySelector(".Pre-Operative-Details");
        if (visibleCount === 0 && patientDetailsSection) {
            patientDetailsSection.style.display = "none";
        }

        // IOP/GAT Table
        const iopGatTable = JSON.parse(localStorage.getItem("iopGatTable")) || {};
        const iopGatTableElement = document.getElementById("Pre-Operative-Table");
        const iopGatHeading = document.getElementById("Pre-Operative-Heading");
        const iopGatRows = iopGatTableElement.querySelectorAll("tbody tr");
        const iopGatRowMappings = [
            { rowIndex: 0, rightKey: "RightmmHg", rightTimeKey: "RightmmHgTime", leftKey: "LeftmmHg", leftTimeKey: "LeftmmHgTime" }
        ];
        let visibleIopGatRowCount = 0;
        iopGatRowMappings.forEach(({ rowIndex, rightKey, rightTimeKey, leftKey, leftTimeKey }) => {
            const rightValue = iopGatTable[rightKey] || "";
            const rightTimeValue = iopGatTable[rightTimeKey] || "";
            const leftValue = iopGatTable[leftKey] || "";
            const leftTimeValue = iopGatTable[leftTimeKey] || "";
            if (rightValue === "" && leftValue === "") {
                iopGatRows[rowIndex].style.display = "none";
            } else {
                iopGatRows[rowIndex].style.display = "";
                iopGatRows[rowIndex].querySelector(`#${rightKey}`).textContent = rightValue || "-";
                iopGatRows[rowIndex].querySelector(`#${rightTimeKey}`).textContent = rightTimeValue || "-";
                iopGatRows[rowIndex].querySelector(`#${leftKey}`).textContent = leftValue || "-";
                iopGatRows[rowIndex].querySelector(`#${leftTimeKey}`).textContent = leftValue || "-";
                visibleIopGatRowCount++;
            }
        });
        iopGatTableElement.style.display = visibleIopGatRowCount > 0 ? "table" : "none";
        iopGatHeading.style.display = visibleIopGatRowCount > 0 ? "block" : "none";

        // Post Operative Medicine Template
        const postOperativeTemplate = JSON.parse(localStorage.getItem("postOperativeTemplate")) || {};
        const post_Operative_Medicine_Table = document.getElementById("Post-Operative-Medicine-Template");
        const postOperativeRows = post_Operative_Medicine_Table.querySelectorAll("tbody tr");
        const postOperativeHeading = document.getElementById("Post-Operative-Medicine-Heading");
        function updatePostOperativeTableVisibility() {
            let isAnyRowVisible = false;
            postOperativeRows.forEach(row => {
                const medicineId = row.id;
                if (postOperativeTemplate[medicineId] === "true") {
                    row.style.display = "";
                    isAnyRowVisible = true;
                } else {
                    row.style.display = "none";
                }
            });
            if (!isAnyRowVisible || Object.keys(postOperativeTemplate).length === 0) {
                post_Operative_Medicine_Table.style.display = "none";
                postOperativeHeading.style.display = "none";
            } else {
                post_Operative_Medicine_Table.style.display = "";
                postOperativeHeading.style.display = "";
            }
        }
        updatePostOperativeTableVisibility();

        // IOL Sticker Checkbox Logic
        const iolStickerCheck = document.getElementById("iol-sticker-check");
        const iolStickerSection = document.getElementById("iol-sticker-section");

        function updateIolStickerVisibility() {
            if (iolStickerCheck.checked) {
                iolStickerSection.classList.remove("hidden");
            } else {
                iolStickerSection.classList.add("hidden");
            }
        }

        iolStickerCheck.addEventListener("change", updateIolStickerVisibility);
        updateIolStickerVisibility(); // Initial update

        // Date Field Update (for admission/discharge inputs)
        function updateDateField(input, spanId) {
            let dateValue = input.value;
            if (dateValue) {
                document.getElementById(spanId).textContent = formatDate(dateValue);
            }
        }
    </script>
</body>
</html>