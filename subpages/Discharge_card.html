<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Record & Operative Procedure</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #fff;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            background: #fff;
            padding: 20px;
            border: 1px solid #000;
        }
        .header-banner img {
            max-width: 1000px;
            height: auto;
            display: block;
        }
        .section-title {
            background: black;
            color: white;
            padding: 5px;
            font-weight: bold;
            text-align: center;
        }
        .table th, .table td {
            border: 1px solid black;
            padding: 5px;
            text-align: center;
            font-size: 14px;
        }
        .procedure-table {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 8px;
        }
        .procedure-box {
            flex: 1;
            min-width: 200px;
            max-width: 220px;
            border: 1px solid black;
            padding: 8px;
            text-align: left;
            font-size: 12px;
            line-height: 1.2;
            background: #f8f9fa;
        }
        .procedure-box strong {
            font-size: 13px;
        }
        .procedure-box ol {
            padding-left: 15px;
        }
        .procedure-box li {
            font-size: 12px;
            margin-bottom: 3px;
        }
        .iol-sticker {
            margin-top: 10px;
            border: 1px solid black;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
        }

        /* Print-specific styles */
        @media print {
            body {
                margin: 0;
                padding: 0;
                background: #fff;
            }
            .container {
                max-width: 100%;
                border: none;
                padding: 0;
                margin: 0;
            }
            .procedure-table {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                gap: 8px;
                margin-top: 0;
            }
            .procedure-box {
                flex: 1;
                min-width: 30%;
                max-width: 30%;
                margin: 0;
                padding: 8px;
                page-break-inside: avoid;
            }
            .table {
                width: 100%;
                margin-left: 0;
            }
            .iol-sticker {
                width: 100%;
                margin-left: 0;
            }
            .d-flex {
                display: flex !important;
            }
            .form-control {
                border: 1px solid #000;
                background: transparent;
                -webkit-print-color-adjust: exact;
            }
            input[type="text"] {
                border: none;
                background: transparent;
                width: 100%;
            }
            input[type="checkbox"] {
                -webkit-appearance: checkbox;
                appearance: checkbox;
            }
            .no-print {
                display: none;
            }
            h4, p, .procedure-box, .table, .iol-sticker {
                margin-top: 0 !important;
            }
            .text-center {
                text-align: center !important;
            }
            .table {
                margin: 0 auto;
            }

            .navbar .buttons button{
                display: none;
            }
            .hr{
                display: none;
            }
            .date-input{
                display: none;
            }
        }

        /* A4 size styling */
        @page {
            size: A4;
            margin: 0;
            margin-top: 20px;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            text-align: center;
        }
        .logo img {
            width: 170px;
            height: auto;
        }
        .hospital-name {
            color: red;
            font-size: 28px;
            font-weight: bold;
            font-family: 'Mangal', sans-serif;
            margin-left: 20px;
        }
        .sub-heading {
            font-size: 16px;
            color: #333;
            margin-top: 5px;
        }
        .doctor-signature {
            margin-top: 30px;
            text-align: right;
        }
        .doctor-signature p {
            margin: 0;
            font-size: 14px;
        }

  /* Responsive styles */
  @media screen and (max-width: 768px) {
            .container {
                padding: 10px;
            }
            th, td {
                font-size: 12px;
                padding: 8px;
            }
            input[type="number"] {
                width: 80px;
            }
        }
        @media screen and (max-width: 480px) {
            .section-title {
                font-size: 14px;
                padding: 8px;
            }
            th, td {
                font-size: 10px;
                padding: 5px;
            }
            input[type="number"] {
                width: 70px;
            }
        }


         /* New CSS for the top navbar image */
         .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f8f8;
            padding: 5px 10px;
      
        }
        .navbar img {
            height: 50px; /* Adjust as needed */
            margin-left: 20px; /* Space between logo and other elements */
        }
        .navbar .buttons {
            display: flex;
            gap: 10px;
        }
        .navbar .buttons button {
            padding: 8px 16px;
            font-size: 14px;
            background: #d32f2f;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
       
    </style>
</head>
<body>
  <!-- Top Navigation Bar -->
  <nav class="navbar">
    <!-- Logo and Hospital Name -->
    <div style="display: flex; align-items: center;">
       
      
    </div>
       
    </div>

    <!-- Image on the Right Side -->
    

    <!-- Action Buttons -->
    <div class="buttons" style="margin-bottom: 10px;">
        <button onclick="window.location.href='./main.html';">üè† Home</button>
        <button onclick="printFunction()" >üñ®Ô∏è Print Discharge Card </button>
    </div>
</nav>

<hr class="hr" style="color: #000;">
<div class="container">
    <!-- Header Section -->
    <div class="header">
        <div class="logo">
            <img src="../assets/images/Ravikalp_Hospital__new_logo-removebg-preview.png" alt="Hospital Logo">
        </div>
        <div class="hospital-name" style="margin-right: 70px;">
            ‡§∞‡§µ‡•Ä‡§ï‡§≤‡•ç‡§™ ‡§π‡•â‡§∏‡•ç‡§™‡§ø‡§ü‡§≤
            <div class="sub-heading">EYE & GENERAL HOSPITAL<br>PHACO & LASER CENTER</div>
        </div>
    </div>
    <hr style="border: 2px solid #000;">

    <!-- Case Record Section -->
    <h4 class="text-center">Discharge Summary</h4>
    <p><strong>Patient ID:</strong> <span id="patient-id"></span></p>
    <p>
    <strong>Name:</strong> <span id="patient-name"></span> 
    <strong style="margin-left: 200px;">Age:</strong> <span id="patient-age"></span> 
    <strong style="margin-left:120px;">Gender:</strong> <span id="patient-gender"></span>
    </p>
    <p><strong>Address:</strong> <span id="patient-address"></span></p>
    <p>
        <strong>DOB:</strong> <span id="patient-dob"></span>
        <strong style="margin-left: 140px;">Date of Addmidion:</strong> <input type="date" class="date-input" id="admissionDate">
        <strong style="margin-left:50px;">Date of Discharge:</strong>  <input type="date" class="date-input" id="dischargeDate">
    </p>
    <p><strong>Diagnosis:</strong> <span class="show-diagnosis"></span> </p>
   
    <div class="d-flex align-items-center">
        <label for="surgeonName" class="form-label me-2"><strong>Surgeon Name:</strong></label>
        <input type="text" id="surgeonName" class="form-control" style="width: 600px;">
    </div>
   
    <div class="d-flex align-items-center" style="margin-top: 10px;">
        <label for="surgery" class="form-label me-2"><strong>Surgery:</strong></label>
        <input type="text" id="surgery" class="form-control" style="width: 600px;margin-left: 50px;">
    </div>

    <hr style="border: 2px solid #000;">
    <h4 class="text-center mt-4">OPERATIVE NOTES </h4>
    
    <div class="procedure-table">
        <div class="procedure-box">
            <input type="checkbox"> <strong>Phaco</strong>
            <ol>
                <li>P & D With Betadin Solution.</li>
                <li>Site Port with 15 Blade.</li>
                <li>Incision clear corneal 2.2mm / 2.8mm.</li>
                <li>Anterior capsule stain with Blue-dye.</li>
                <li>Capsulorhexis done with cystotome.</li>
                <li>Hydrodelineation & Hydrodissection done.</li>
                <li>Phaco-Treaching & Aspiration with Phaco Probe.</li>
                <li>Foldable IOL kept in Bag.</li>
                <li>Wound Hydrated.</li>
                <li>Eye Patched.</li>
            </ol>
        </div>

        <div class="procedure-box">
            <input type="checkbox"> <strong>SICS</strong>
            <ol>
                <li>P & D Dropping with Betadine.</li>
                <li>Conjunctival Flap Done.</li>
                <li>Tunnel with crescent Blade.</li>
                <li>Site port with 15 No Blade.</li>
                <li>Capsulorhexis with cystotome.</li>
                <li>Main entry done with 3.2 Blade.</li>
                <li>Hydrodissection done.</li>
                <li>Nucleus delivery with vectis.</li>
                <li>Cortex aspiration with symcoe cannula.</li>
                <li>PCL kept in Bag.</li>
                <li>Wound Hydrated.</li>
                <li>Subconj inj. given.</li>
                <li>Eye Patched.</li>
            </ol>
        </div>

        <div class="procedure-box">
            <input type="checkbox"> <strong>Pterygium</strong>
            <ol>
                <li>P & D Done.</li>
                <li>Subconj inj. given.</li>
                <li>Main Mass separated from cornea.</li>
                <li>Pungium Excised.</li>
                <li>Superiority graft Separates & Put on excised area.</li>
                <li>Clint instilled.</li>
                <li>Eye Patched.</li>
            </ol>
        </div>
    </div>

    <!-- Eye Exam Section -->
    <h4 class="text-center mt-4" style="margin-top: 30px;" id="A-Scan-Heading">A-Scan Report</h4>
    <table class="table" style="width: 450px; margin: 0 auto;" id="A-Scan-Table">
        <thead>
            <tr>
                <th></th>
                <th>Right</th>
                <th>Left</th>
        </thead>
        <tbody>
            <tr><td>K1</td>
                <td id="RightK1"></td>
                <td id="LeftK1"></td>
            </tr>
            <tr><td>K2</td>
                <td id="RightK2"></td>
                <td id="LeftK2"></td>
            </tr>
            <tr><td>AXL</td>
                <td id="RightAL"></td>
                <td id="LeftAL"></td>
            </tr>
            <tr><td>IOL</td>
                <td id="RightIOL"></td>
                <td id="LeftIOL"></td>
            </tr>
        </tbody>
    </table>
 

    <!-- Investigation Section -->
    <h4 class="text-center mt-4" id="investigation-title">Investigation</h4>
    <p style="margin-top: 20px; text-align: center;" class="show-investigation">
        <strong>CBC=HB :</strong> 12  
        <strong style="margin-left: 80px;">BSL R :</strong> 92  
        <strong style="margin-left:50px;">BSL  :</strong> 92 
        <strong style="margin-left:50px;">BSL  :</strong> 92 
    </p>
  

    <!-- IOL Sticker Section -->
    <h4 class="text-center mt-4">IOL STICKER</h4>
    <div class="iol-sticker" style="width: 380px; margin: 0 auto; height: 150px;"></div>

    <!-- Doctor's Signature Section -->
    <div class="doctor-signature">
        <p><strong>Dr. Alvin Rane :</strong> ___________________________</p>
       
    </div>

    <!-- Print Button -->
   
</div>

<script>
     function printFunction() {
            const patientId = "P"+appointment.id;
            // Get todays date with dd-mm-yyyy format
            const today = new Date();
            const date = `${today.getDate().toString().padStart(2, '0')}-${(today.getMonth() + 1).toString().padStart(2, '0')}-${today.getFullYear()}`;
            const Docname = patientId+"_DischargeCard" + "_" + date;

            console.log(patientId,date,Docname);

            window.electronAPI.printPage(patientId, date, Docname);
        }
     // Retrieve the appointment object from localStorage
     const appointment = JSON.parse(window.localStorage.getItem("appointment")) || {};

       // Function to format date from YYYY-MM-DD to DD-MM-YYYY
    function formatDate(isoDate) {
        if (!isoDate) return "N/A";  // Return "N/A" if date is missing
        const [year, month, day] = isoDate.split("-");
        return `${day}-${month}-${year}`;
    }

    // Update the HTML elements with appointment data
    document.getElementById("patient-id").textContent = appointment.id || "N/A";
    document.getElementById("patient-name").textContent = appointment.Name || "N/A";
    document.getElementById("patient-age").textContent = appointment.Age ? appointment.Age + " yrs" : "N/A";
    document.getElementById("patient-gender").textContent = appointment.Gender || "N/A";
    document.getElementById("patient-dob").textContent = appointment.BirthDate || "N/A";
    document.getElementById("patient-dob").textContent = formatDate(appointment.BirthDate);

    // Retrieve selected diagnoses from localStorage
    const selectedDiagnosis = JSON.parse(localStorage.getItem("selectedDiagnosis")) || [];

    // Display selected diagnoses in the "Diagnosis" section
    // Get the diagnosis display section
    const diagnosisSection = document.querySelector(".show-diagnosis");
    // Only update if there are diagnoses to show
    if (selectedDiagnosis.length > 0) {
        diagnosisSection.innerHTML = `
        
            ${selectedDiagnosis.join(' <span style="font-weight: bold; color: black;">|</span> ')}
        `;
    } else {
        diagnosisSection.innerHTML = `
        
            N/A
        `;
    }

    // Load the A-Scan table from local storage 
    const aScanTable = JSON.parse(localStorage.getItem("aScanTable")) || {};
        
        // Get table and heading elements
        const aScanTableElement = document.getElementById("A-Scan-Table");
        const aScanHeading = document.getElementById("A-Scan-Heading");
        const aScanRows = aScanTableElement.querySelectorAll("tbody tr");

        // Define the mapping for each row and its respective keys in aScanTable
        const aScanRowMapping = [
            { rowIndex: 0, rightKey: "RightK1", leftKey: "LeftK1" },
            { rowIndex: 1, rightKey: "RightK2", leftKey: "LeftK2" },
            { rowIndex: 2, rightKey: "RightAL", leftKey: "LeftAL" },
            { rowIndex: 3, rightKey: "RightIOL", leftKey: "LeftIOL" }
        ];

        let visibleAScanRowCount = 0;

        aScanRowMapping.forEach(({ rowIndex, rightKey, leftKey }) => {
            const rightValue = aScanTable[rightKey] || "";
            const leftValue = aScanTable[leftKey] || "";

            // Hide the row if both values are empty
            if (rightValue === "" && leftValue === "") {
                aScanRows[rowIndex].style.display = "none";
            } else {
                aScanRows[rowIndex].style.display = ""; // Ensure it's visible if not empty
                aScanRows[rowIndex].querySelector(`#${rightKey}`).textContent = rightValue || "-";
                aScanRows[rowIndex].querySelector(`#${leftKey}`).textContent = leftValue || "-";
                visibleAScanRowCount++;
            }
        });


        // Show or hide the entire table if all rows are hidden
        aScanTableElement.style.display = visibleAScanRowCount > 0 ? "table" : "none";

        // Show or hide the heading based on whether the table is visible
        aScanHeading.style.display = visibleAScanRowCount > 0 ? "block" : "none";


    // Retrieve selected investigations from localStorage
    const selectedInvestigations = JSON.parse(localStorage.getItem("selectedInvestigation")) || [];

    // Get the investigation display section
    const investigationSection = document.querySelector(".show-investigation");

    // Only update if there are investigations to show
    if (selectedInvestigations.length > 0) {
        // Format investigations correctly by adding ":" after each one
        const formattedInvestigations = selectedInvestigations.map(item => `${item}:`).join(' <span style="font-weight: bold; color: black; margin-left: 60px;">|</span> ');

        investigationSection.innerHTML = `<strong>${formattedInvestigations}</strong>`;
    } else {
        // Hide investigation section and title
        document.getElementById("investigation-title").style.display = "none";
        investigationSection.style.display = "none";
    }

</script>

</body>
</html>